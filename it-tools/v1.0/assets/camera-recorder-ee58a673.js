import{o as e,e as a,f as n,b as N,p as w,a1 as ie,d as ae,a2 as se,a3 as ce,a4 as re,a5 as le,g as t,c as _,w as c,F as de,r as ue,x as _e,m as U,k as v,h as r,y as j,N as R,t as ve,O as pe,n as me,a6 as he}from"./index-2e588a01.js";const fe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ge=n("path",{fill:"currentColor",d:"M6 19a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V7H6zM8 9h8v10H8zm7.5-5l-1-1h-5l-1 1H5v2h14V4z"},null,-1),ke=[ge];function we(u,i){return e(),a("svg",fe,[...ke])}const ye={name:"mdi-delete-outline",render:we},xe={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},$e=n("path",{fill:"currentColor",d:"M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7z"},null,-1),Ce=[$e];function be(u,i){return e(),a("svg",xe,[...Ce])}const Re={name:"mdi-download",render:be},Me={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Be=n("path",{fill:"currentColor",d:"M19 12c0 3.86-3.14 7-7 7s-7-3.14-7-7s3.14-7 7-7s7 3.14 7 7"},null,-1),Ve=[Be];function He(u,i){return e(),a("svg",Me,[...Ve])}const Ie={name:"mdi-record",render:He},Se={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},ze=n("path",{fill:"currentColor",d:"M8 5.14v14l11-7z"},null,-1),Ue=[ze];function je(u,i){return e(),a("svg",Se,[...Ue])}const Ne={name:"mdi-play",render:je},Ae={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},De=n("path",{fill:"currentColor",d:"M14 19h4V5h-4M6 19h4V5H6z"},null,-1),Ee=[De];function Le(u,i){return e(),a("svg",Ae,[...Ee])}const Pe={name:"mdi-pause",render:Le},Te={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Oe=n("path",{fill:"currentColor",d:"M17 10.5V7a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3.5l4 4v-11z"},null,-1),qe=[Oe];function Fe(u,i){return e(),a("svg",Te,[...qe])}const Ge={name:"mdi-video",render:Fe},We={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"},Je=n("path",{fill:"currentColor",d:"M4 4h3l2-2h6l2 2h3a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2m8 3a5 5 0 0 0-5 5a5 5 0 0 0 5 5a5 5 0 0 0 5-5a5 5 0 0 0-5-5m0 2a3 3 0 0 1 3 3a3 3 0 0 1-3 3a3 3 0 0 1-3-3a3 3 0 0 1 3-3"},null,-1),Ke=[Je];function Qe(u,i){return e(),a("svg",We,[...Ke])}const Xe={name:"mdi-camera",render:Qe};function Ye({stream:u}){const i=N(()=>MediaRecorder.isTypeSupported("video/webm")),o=w(null),C=w([]),M=ie(),l=w("stopped"),p=()=>{const g=new Blob(C.value,{type:"video/webm"}),H=URL.createObjectURL(g);return C.value=[],H};return{isRecordingSupported:i,startRecording:()=>{i.value&&u.value&&l.value==="stopped"&&(o.value=new MediaRecorder(u.value,{mimeType:"video/webm"}),o.value.ondataavailable=g=>{g.data.size>0&&C.value.push(g.data)},o.value.onstop=()=>{M.trigger(p())},o.value.state==="inactive"&&(o.value.start(),l.value="recording"))},stopRecording:()=>{i.value&&o.value&&l.value!=="stopped"&&(o.value.stop(),l.value="stopped")},pauseRecording:()=>{i.value&&o.value&&l.value==="recording"&&(o.value.pause(),l.value="paused")},resumeRecording:()=>{i.value&&o.value&&l.value==="paused"&&(o.value.resume(),l.value="recording")},recordingState:l,onRecordAvailable:M.on}}const Ze={key:1,"mt-4":"",flex:"","justify-center":""},et={flex:"","flex-col":"","gap-2":""},tt={key:0,"mt-3":"",flex:"","justify-center":""},nt={key:1},ot={"my-2":""},it={flex:"","items-center":"","justify-between":"","gap-2":""},at={"mr-2":""},st={key:0,flex:"","justify-center":"","gap-2":""},ct={"mr-2":""},rt={"mr-2":""},lt={"mr-2":""},dt={"mr-2":""},ut={key:1,italic:"","op-60":""},_t={grid:"","grid-cols-2":"","mt-5":"","gap-2":""},vt=["src"],pt=["src"],mt={flex:"","items-center":"","justify-between":""},ht={"font-bold":""},ft={flex:"","gap-2":""},wt=ae({__name:"camera-recorder",setup(u){const{videoInputs:i,audioInputs:o,permissionGranted:C,isSupported:M,ensurePermissions:l}=se({requestPermissions:!0,constraints:{video:!0,audio:!0},onUpdated(){q()}}),p=w(),x=w([]),f=w(i.value[0]?.deviceId),m=w(o.value[0]?.deviceId),V=w(!1),{stream:g,start:H,stop:A,enabled:I}=ce({constraints:N(()=>({video:{deviceId:f.value},...m.value?{audio:{deviceId:m.value}}:{}})),autoSwitch:!0}),{isRecordingSupported:D,onRecordAvailable:E,startRecording:L,stopRecording:P,pauseRecording:T,recordingState:B,resumeRecording:O}=Ye({stream:g});E(s=>{x.value.unshift({type:"video",value:s,createdAt:new Date})});function q(){(U.isNil(f)||!i.value.find(s=>s.deviceId===f.value))&&(f.value=i.value[0]?.deviceId),(U.isNil(o)||!o.value.find(s=>s.deviceId===m.value))&&(m.value=o.value[0]?.deviceId)}function F(){if(!p.value)return;const s=document.createElement("canvas");s.width=p.value.videoWidth,s.height=p.value.videoHeight,s.getContext("2d")?.drawImage(p.value,0,0);const k=s.toDataURL("image/png");x.value.unshift({type:"image",value:k,createdAt:new Date})}re(()=>{p.value&&g.value&&(p.value.srcObject=g.value)}),le(()=>A());async function G(){try{await l()}catch{V.value=!0}}function W({type:s,value:k,createdAt:$}){const b=document.createElement("a");b.href=k,b.download=`${s}-${$.getTime()}.${s==="image"?"png":"webm"}`,b.click()}return(s,k)=>{const $=_e,b=pe,h=me,S=he,J=Xe,K=Ge,Q=Pe,X=Ne,Y=Ie,Z=Re,ee=ye;return e(),a("div",null,[t(M)?t(C)?(e(),_($,{key:2},{default:c(()=>[n("div",et,[r(S,{value:t(f),"onUpdate:value":k[0]||(k[0]=d=>j(f)?f.value=d:null),"label-position":"left","label-width":"60px",label:"视频：",options:t(i).map(({deviceId:d,label:y})=>({value:d,label:y})),placeholder:"选择相机"},null,8,["value","options"]),t(m)&&t(o).length>0?(e(),_(S,{key:0,value:t(m),"onUpdate:value":k[1]||(k[1]=d=>j(m)?m.value=d:null),label:"音频：","label-position":"left","label-width":"60px",options:t(o).map(({deviceId:d,label:y})=>({value:d,label:y})),placeholder:"选择麦克风"},null,8,["value","options"])):R("",!0)]),t(I)?(e(),a("div",nt,[n("div",ot,[n("video",{ref_key:"video",ref:p,autoplay:"",controls:"",playsinline:"","max-h-full":"","w-full":""},null,512)]),n("div",it,[r(h,{disabled:!t(I),onClick:F},{default:c(()=>[n("span",at,[r(J)]),v(" 截图 ")]),_:1},8,["disabled"]),t(D)?(e(),a("div",st,[t(B)==="stopped"?(e(),_(h,{key:0,onClick:t(L)},{default:c(()=>[n("span",ct,[r(K)]),v(" 开始录制 ")]),_:1},8,["onClick"])):R("",!0),t(B)==="recording"?(e(),_(h,{key:1,onClick:t(T)},{default:c(()=>[n("span",rt,[r(Q)]),v(" 暂停 ")]),_:1},8,["onClick"])):R("",!0),t(B)==="paused"?(e(),_(h,{key:2,onClick:t(O)},{default:c(()=>[n("span",lt,[r(X)]),v(" 继续 ")]),_:1},8,["onClick"])):R("",!0),t(B)!=="stopped"?(e(),_(h,{key:3,type:"error",onClick:t(P)},{default:c(()=>[n("span",dt,[r(Y)]),v(" 停止 ")]),_:1},8,["onClick"])):R("",!0)])):(e(),a("div",ut," 您的浏览器不支持视频录制 "))])])):(e(),a("div",tt,[r(h,{type:"primary",onClick:t(H)},{default:c(()=>[v(" 启动摄像头 ")]),_:1},8,["onClick"])]))]),_:1})):(e(),_($,{key:1,"text-center":""},{default:c(()=>[v(" 您需要授予使用摄像头和麦克风的权限 "),t(V)?(e(),_(b,{key:0,"mt-4":"","text-left":""},{default:c(()=>[v(" 您的浏览器已阻止权限请求或不支持它。 您需要在浏览器设置中手动授予权限（通常是地址栏中的锁定图标）。 ")]),_:1})):(e(),a("div",Ze,[r(h,{onClick:G},{default:c(()=>[v(" 授予权限 ")]),_:1})]))]),_:1})):(e(),_($,{key:0},{default:c(()=>[v(" 您的浏览器不支持摄像头录制视频 ")]),_:1})),n("div",_t,[(e(!0),a(de,null,ue(t(x),({type:d,value:y,createdAt:te},z)=>(e(),_($,{key:z},{default:c(()=>[d==="image"?(e(),a("img",{key:0,src:y,"max-h-full":"","w-full":"",alt:"截图"},null,8,vt)):(e(),a("video",{key:1,src:y,controls:"","max-h-full":"","w-full":""},null,8,pt)),n("div",mt,[n("div",ht,ve(d==="image"?"截图":"视频"),1),n("div",ft,[r(h,{onClick:ne=>W({type:d,value:y,createdAt:te})},{default:c(()=>[r(Z)]),_:2},1032,["onClick"]),r(h,{onClick:ne=>x.value=t(x).filter((gt,oe)=>oe!==z)},{default:c(()=>[r(ee)]),_:2},1032,["onClick"])])])]),_:2},1024))),128))])])}}});export{wt as default};
