import{m as i,h as a,F as y,k as T,v as O,d as b,p as g,J as $,a7 as L,b as m,g as l,e as J,f as z,w as V,N as H,x as I,H as M,o as v,y as x,c as j,B as G,z as K}from"./index-2e588a01.js";import{J as h}from"./index-d4e515d0.js";import{_ as P}from"./FormItem-60cf44aa.js";import{_ as Q}from"./Switch-48006b55.js";import{w as A}from"./defaults-4d6daddf.js";import{i as W}from"./boolean-f2550a48.js";import"./use-form-item-6311a236.js";function X(e,t,{onlyShowDifferences:s=!1}={}){return i.isArray(e)&&i.isArray(t)?{key:"",type:"array",children:E(e,t,{onlyShowDifferences:s}),oldValue:e,value:t,status:p(e,t)}:i.isObject(e)&&i.isObject(t)?{key:"",type:"object",children:S(e,t,{onlyShowDifferences:s}),oldValue:e,value:t,status:p(e,t)}:{key:"",type:"value",oldValue:e,value:t,status:p(e,t)}}function S(e,t,{onlyShowDifferences:s=!1}={}){return Object.keys({...e,...t}).map(n=>D(e?.[n],t?.[n],n,{onlyShowDifferences:s})).filter(n=>!s||n.status!=="unchanged")}function D(e,t,s,{onlyShowDifferences:r=!1}={}){const n=_(e);return n==="object"?{key:s,type:n,children:S(e,t,{onlyShowDifferences:r}),oldValue:e,value:t,status:p(e,t)}:n==="array"?{key:s,type:n,children:E(e,t,{onlyShowDifferences:r}),value:t,oldValue:e,status:p(e,t)}:{key:s,type:n,value:t,oldValue:e,status:p(e,t)}}function E(e,t,{onlyShowDifferences:s=!1}={}){const r=Math.max(0,e?.length,t?.length);return Array.from({length:r},(n,o)=>D(e?.[o],t?.[o],o,{onlyShowDifferences:s})).filter(n=>!s||n.status!=="unchanged")}function _(e){return e===null?"value":Array.isArray(e)?"array":typeof e=="object"?"object":"value"}function p(e,t){if(e===void 0)return"added";if(t===void 0)return"removed";const s=_(e)==="object"&&_(t)==="object",r=_(e)==="array"&&_(t)==="array";return i.isEqual(e,t)?"unchanged":s||r?"children-updated":"updated"}function Y({diff:e}){return a("div",{class:"diffs-viewer"},[a("ul",null,[R({diff:e,showKeys:!1})])])}function R({diff:e,showKeys:t=!0}){const{type:s,status:r}=e;return r==="updated"?w({diff:e,showKeys:t}):s==="array"?C({diff:e,showKeys:t,showChildrenKeys:!1,openTag:"[",closeTag:"]"}):s==="object"?C({diff:e,showKeys:t,openTag:"{",closeTag:"}"}):Z({diff:e,showKeys:t})}function Z({diff:e,showKeys:t}){const{value:s,key:r,status:n,oldValue:o}=e,u=n==="removed"?o:s;return a("li",null,[a("span",{class:[n,"result"]},[t&&a(y,null,[a("span",{class:"key"},[r]),": "]),k({value:u,status:n})]),T(",")])}function w({diff:e,showKeys:t}){const{value:s,key:r,oldValue:n}=e;return a("li",{class:"updated-line"},[t&&a(y,null,[a("span",{class:"key"},[r]),": "]),k({value:n,status:"removed"}),k({value:s,status:"added"}),T(",")])}function C({diff:e,openTag:t,closeTag:s,showKeys:r,showChildrenKeys:n=!0}){const{children:o,key:u,status:c,type:f}=e;return a("li",null,[a("div",{class:[f,c],style:{display:"inline-block"}},[r&&a(y,null,[a("span",{class:"key"},[u]),": "]),t,o.length>0&&a("ul",null,[o.map(d=>R({diff:d,showKeys:n}))]),`${s},`])])}function ee(e){return i.isNull(e)?"null":JSON.stringify(e)}function k({value:e,status:t}){const s=ee(e),{copy:r}=O({source:s});return a("span",{class:["value",t],onClick:()=>r()},[s])}const te={key:0},se={flex:"","justify-center":""},ne={key:0,"text-center":"","op-70":""},re=b({__name:"diff-viewer",props:{leftJson:{},rightJson:{}},setup(e){M(d=>({"15d4ed85":l(o).text.mutedColor,"4752c4b8":l(o).success.colorFaded,"75f5bbb8":l(o).success.color,"6dfe8902":l(o).error.colorFaded,52708769:l(o).error.color,"0a17deb6":l(o).text.baseColor}));const t=e,s=g(!1),{leftJson:r,rightJson:n}=$(t),o=L(),u=m(()=>X(r.value,n.value,{onlyShowDifferences:s.value})),c=m(()=>i.isEqual(r.value,n.value)),f=m(()=>!i.isUndefined(r.value)&&!i.isUndefined(n.value));return(d,N)=>{const B=Q,U=P,q=I;return l(f)?(v(),J("div",te,[z("div",se,[a(U,{label:"仅显示差异","label-placement":"left"},{default:V(()=>[a(B,{value:l(s),"onUpdate:value":N[0]||(N[0]=F=>x(s)?s.value=F:null)},null,8,["value"])]),_:1})]),a(q,{"data-test-id":"diff-result"},{default:V(()=>[l(c)?(v(),J("div",ne," 两个 JSON 是相同的 ")):(v(),j(l(Y),{key:1,diff:l(u)},null,8,["diff"]))]),_:1})])):H("",!0)}}});const ae=G(re,[["__scopeId","data-v-fd0f3a60"]]),pe=b({__name:"json-diff",setup(e){const t=g(""),s=g(""),r=m(()=>A(()=>h.parse(t.value),void 0)),n=m(()=>A(()=>h.parse(s.value),void 0)),o=[{validator:u=>u===""||W(()=>h.parse(u)),message:"JSON格式错误"}];return(u,c)=>{const f=K;return v(),J(y,null,[a(f,{value:l(t),"onUpdate:value":c[0]||(c[0]=d=>x(t)?t.value=d:null),"validation-rules":o,label:"基础 JSON",placeholder:"输入基础JSON",rows:"20",multiline:"","test-id":"leftJson","raw-text":"",monospace:""},null,8,["value"]),a(f,{value:l(s),"onUpdate:value":c[1]||(c[1]=d=>x(s)?s.value=d:null),"validation-rules":o,label:"对比 JSON",placeholder:"输入要比较的JSON",rows:"20",multiline:"","test-id":"rightJson","raw-text":"",monospace:""},null,8,["value"]),a(ae,{"left-json":l(r),"right-json":l(n)},null,8,["left-json","right-json"])],64)}}});export{pe as default};
